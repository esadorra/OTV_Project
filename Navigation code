#include "math.h"
#include "Arduino.h"
#include "Enes100.h"
#include "Tank.h"

// H-bridge for left side wheels
// Motor A direction control pins front left
int in1L = 2;
int in2L = 4;
// Motor B direction control pins bottom left
int in3L = 6;
int in4L = 7;
// H-bridge for right side wheels
// Motor C direction control pins front right
int in1R = 8;
int in2R = 9;
// Motor D direction control pins bottom right
int in3R = 10;
int in4R = 11;

void setup() {

      pinMode(in1L, OUTPUT);
  pinMode(in2L, OUTPUT);
  pinMode(in3L, OUTPUT);
  pinMode(in4L, OUTPUT);
  pinMode(in1R, OUTPUT);
  pinMode(in2R, OUTPUT);
  pinMode(in3R, OUTPUT);
  pinMode(in4R, OUTPUT);

  // Turn off motors - Initial state
  digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);

    Enes100.begin("elephants", HYDROGEN, 19, 1116, 12, 13);
    Tank.begin();
    
    Enes100.println("Starting rotation");
    float xcoordinate = Enes100.getX();
    float ycoordinate = Enes100.getY();
    float startTheta = Enes100.getTheta();
    float targetChange = PI/2;
    float theta;
    float disrtancex = 30.5;
    float NewTheta;
    float ThirdTheta; 
    float LastTheta;
    delay(5000);
    float startingpositionright = Enes100.getY();
    
startingpositionright = Enes100.getY();
// sees if we start on the left or on the right
if (startingpositionright < 1){
// input code starting from the right
// rotate until pi/2 

while (startTheta != 1.461){ // while (startTheta does not equal 1.461)
    startTheta = Enes100.getTheta();
     digitalWrite(in1L, LOW);
    digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
    startTheta = Enes100.getTheta();
    
    if (startTheta = 1.461){ // if startTheta = 1.461
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
        startTheta = Enes100.getTheta();
        
        delay(1000);
    }
    delay(10);
}
// forward to mission site 
    while (ycoordinate < 1.5){
    // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();

  if (ycoordinate > 1.5){
      digitalWrite(in1L, LOW);
    digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  delay(1000);
  }
}
//mission code HERE
// back up a litte
while (ycoordinate > 1){
    ycoordinate = Enes100.getY();
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, HIGH);
  //D
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, HIGH);
  ycoordinate = Enes100.getY();

  if (ycoordinate < 1){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  delay(1000);
  }
}
// rotate until 0
while (NewTheta = Enes100.getTheta() > 0.10920){
    NewTheta = Enes100.getTheta();  
    digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, HIGH);
  //D
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, HIGH);
    NewTheta = Enes100.getTheta();
    
    if (NewTheta <= 0.10920){
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
        NewTheta = Enes100.getTheta();
        
        delay(1000);
    }
    delay(10);
}
// forward a little
while (xcoordinate < 1.0){
    // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  xcoordinate = Enes100.getX();
  if (xcoordinate > 1.0){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  xcoordinate = Enes100.getX();

  delay(1000);
  }
}
// rotate until pi/2 
while (ThirdTheta != 1.461){ // while (startTheta does not equal 1.461)
    ThirdTheta = Enes100.getTheta();
     digitalWrite(in1L, LOW);
    digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
    ThirdTheta = Enes100.getTheta();
    
    if (ThirdTheta = 1.461){ // if startTheta = 1.461
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
       ThirdTheta = Enes100.getTheta();
        
        delay(1000);
    }
    delay(10);
}
//forward to arena edge 
while (ycoordinate < 1.9){
    // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  if (ycoordinate >= 1.9){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  delay(1000);
  }
}
} else {
// input coode starting from left
// rotate until -pi/2
while (startTheta != 0){
    startTheta = Enes100.getTheta();
    // OTV TURN RIGHT
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, HIGH);
  //D
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, HIGH);
  startTheta = Enes100.getTheta();
  if (startTheta = 0){
    digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  startTheta = Enes100.getTheta();

  delay(1000);
  }
  delay(10); 
}
// move straight forward to mission site
while (ycoordinate > 0.5){
      // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  if (ycoordinate <= 0.5){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();

  delay(1000);
  }
}
//mission code HERE
// back up a little
while (ycoordinate < 1){
    ycoordinate = Enes100.getY();
      // OTV BACKWARD
  //A
  digitalWrite(in1L, LOW);
  digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, HIGH);
  //D
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, HIGH);
  ycoordinate = Enes100.getY();
  if (ycoordinate >= 1){
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
    ycoordinate = Enes100.getY();
    
    delay(1000);
  }
}
// rotate until 0 
while(NewTheta = Enes100.getTheta() != 0){
    // OTV LEFT
    NewTheta = Enes100.getTheta();
  //A
  digitalWrite(in1L, LOW);
  digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  NewTheta = Enes100.getTheta();

  if (startTheta = 0){
    digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
        startTheta = Enes100.getTheta();
        
        delay(1000);
  }
  delay(10);
}
// forward for a little
while (xcoordinate < 1){
    // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  xcoordinate = Enes100.getX();
  if (xcoordinate > 1){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  xcoordinate = Enes100.getX();

  delay(1000);
  }
}
//rotate until pi/2 
while (ThirdTheta != 1.461){ // while (startTheta does not equal 1.461)
    ThirdTheta = Enes100.getTheta();
     digitalWrite(in1L, LOW);
    digitalWrite(in2L, HIGH);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
    ThirdTheta = Enes100.getTheta();
    
    if (ThirdTheta = 1.461){ // if startTheta = 1.461
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
       ThirdTheta = Enes100.getTheta();
        
        delay(1000);
    }
    delay(10);
}
//forward until edge of arena 
while (ycoordinate < 1.9){
    // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  if (ycoordinate >= 1.9){
      digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  delay(1000);
  }
}
}
// move along wall to desired x coordinate, passed all the obstacles 
while (xcoordinate < 2.86){
     // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  xcoordinate = Enes100.getX();
  if (xcoordinate > 2.86){
    digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
    ycoordinate = Enes100.getY();
    
    delay(1000);
  }
}
//slide right until desired y coordinate
while (ycoordinate > 1.5){
    // OTV SLIDE RIGHT
    ycoordinate = Enes100.getY();
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, HIGH);
  //C
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, HIGH);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);
  ycoordinate = Enes100.getY();
  if (ycoordinate < 1.5){
        digitalWrite(in1L, LOW);
  digitalWrite(in2L, LOW);
  digitalWrite(in3L, LOW);
  digitalWrite(in4L, LOW);
  digitalWrite(in1R, LOW);
  digitalWrite(in2R, LOW);
  digitalWrite(in3R, LOW);
  digitalWrite(in4R, LOW);
    ycoordinate = Enes100.getY();
    
    delay(1000);
  }
}
// forward under the barrier 
 // OTV FORWARD
  //A
  digitalWrite(in1L, HIGH);
  digitalWrite(in2L, LOW);
  //B
  digitalWrite(in3L, HIGH);
  digitalWrite(in4L, LOW);
  //C
  digitalWrite(in1R, HIGH);
  digitalWrite(in2R, LOW);
  //D
  digitalWrite(in3R, HIGH);
  digitalWrite(in4R, LOW);





}


void loop()
{
    delay(1000);
    Enes100.print("X = "); Enes100.println(Enes100.getX());
    Enes100.print("Y = "); Enes100.println(Enes100.getY());
    Enes100.print("Theta = "); Enes100.println(Enes100.getTheta());
    
}
